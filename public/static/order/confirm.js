!function(e){var t={};function s(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s(s.s=17)}({17:function(e,t,s){e.exports=s("JrVn")},"6aaD":function(e,t,s){"use strict";s.r(t);var a=s("mmJj"),r=s.n(a);for(var i in a)"default"!==i&&function(e){s.d(t,e,(function(){return a[e]}))}(i);t.default=r.a},"89dg":function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"area"},[s("div",{staticClass:"order-address"},[e._m(0),e._v(" "),s("ul",{staticClass:"address-list",attrs:{id:"address-list"}},e._l(e.addresses,(function(t){return s("li",[s("a",{staticClass:"edit-address",on:{click:function(s){return e.handleEditAddress(t)}}},[e._v("修改本地址")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.address,expression:"address"}],attrs:{title:"",type:"radio"},domProps:{value:t,checked:e._q(e.address,t)},on:{change:function(s){e.address=t}}}),e._v(" "),s("span",[e._v(e._s(t.full_address)+"  ("+e._s(t.name)+" 收) "+e._s(t.tel))])])})),0),e._v(" "),s("div",{staticClass:"use-new-address"},[s("a",{staticClass:"button",on:{click:function(t){return e.handleAddAddress()}}},[e._v("+使用新地址")])])]),e._v(" "),s("div",{staticClass:"blank"}),e._v(" "),s("div",{staticClass:"container"},[s("h3",[e._v("确认订单信息")]),e._v(" "),s("table",{staticClass:"order-table"},[e._m(1),e._v(" "),s("tbody",e._l(e.items,(function(t,a){return s("tr",{key:a},[s("td",[s("div",{staticClass:"item-info"},[s("img",{staticClass:"thumb",attrs:{src:t.product.thumb,alt:""}}),e._v(" "),s("div",{staticClass:"more-info"},[s("div",{staticClass:"item-title"},[e._v(e._s(t.product.title))]),e._v(" "),s("div",{staticClass:"item-attr"},[e._v(e._s(t.sku.title))])])])]),e._v(" "),s("td",[e._v(e._s(t.sku.price))]),e._v(" "),s("td",[e._v(e._s(t.quantity))]),e._v(" "),s("td",[e._v("￥"+e._s(t.total_fee))])])})),0)]),e._v(" "),s("div",{staticClass:"order-extra"},[s("div",{staticClass:"order-extra-row"},[s("div",{staticClass:"col-label"},[e._v("给掌柜留言:")]),e._v(" "),s("div",{staticClass:"col-input"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"remark"}],staticClass:"textarea",attrs:{placeholder:"选填:对本次交易的说明"},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value)}}})]),e._v(" "),s("div",[e._v("合计: "),s("span",{staticClass:"total-fee"},[e._v(e._s(e.order_fee))]),e._v("元(含运费:"+e._s(e.shipping_fee)+"元)")])]),e._v(" "),s("div",{staticClass:"order-extra-row"},[s("div",{staticClass:"col-label"},[e._v("运送方式:")]),e._v(" "),s("div",{staticClass:"col-input"},[s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.shipping_type,expression:"shipping_type"}],attrs:{type:"radio"},domProps:{value:1,checked:e._q(e.shipping_type,1)},on:{change:function(t){e.shipping_type=1}}}),e._v(" 快递")]),e._v(" "),s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.shipping_type,expression:"shipping_type"}],attrs:{type:"radio"},domProps:{value:2,checked:e._q(e.shipping_type,2)},on:{change:function(t){e.shipping_type=2}}}),e._v(" 上门自取")])])])]),e._v(" "),s("div",{staticClass:"order-btns"},[s("div",{staticClass:"flex"}),e._v(" "),s("button",{staticClass:"btn-submit",attrs:{type:"button"},on:{click:e.submit}},[e._v("提交订单")])])]),e._v(" "),s("address-form",{attrs:{address:e.newaddress},on:{saved:e.handleSavedAddress},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}})],1)},r=[function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{staticClass:"confirm-address"},[t("a",{staticClass:"manage-address",attrs:{href:"/user/#/address",target:"_blank"}},[this._v("管理收货地址")]),this._v(" "),t("span",[this._v("确认收货地址")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("thead",[t("tr",[t("th",{staticClass:"align-left"},[this._v("宝贝")]),this._v(" "),t("th",{attrs:{width:"125"}},[this._v("单价")]),this._v(" "),t("th",{attrs:{width:"100"}},[this._v("数量")]),this._v(" "),t("th",{attrs:{width:"100"}},[this._v("小计")])])])}]},JrVn:function(e,t,s){"use strict";var a,r=(a=s("KvjX"))&&a.__esModule?a:{default:a};new Vue({el:"#app",render:function(e){return e(r.default)}})},"KHd+":function(e,t,s){"use strict";function a(e,t,s,a,r,i,n,d){var o,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=s,l._compiled=!0),a&&(l.functional=!0),i&&(l._scopeId="data-v-"+i),n?(o=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},l._ssrRegister=o):r&&(o=d?function(){r.call(this,this.$root.$options.shadowRoot)}:r),o)if(l.functional){l._injectStyles=o;var c=l.render;l.render=function(e,t){return o.call(t),c(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,o):[o]}return{exports:e,options:l}}s.d(t,"a",(function(){return a}))},KvjX:function(e,t,s){"use strict";s.r(t);var a=s("89dg"),r=s("Rukd");for(var i in r)"default"!==i&&function(e){s.d(t,e,(function(){return r[e]}))}(i);var n=s("KHd+"),d=Object(n.a)(r.default,a.a,a.b,!1,null,"c9d0c9a0",null);t.default=d.exports},Rukd:function(e,t,s){"use strict";s.r(t);var a=s("Yg+7"),r=s.n(a);for(var i in a)"default"!==i&&function(e){s.d(t,e,(function(){return a[e]}))}(i);t.default=r.a},"Yg+7":function(e,t,s){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={name:"ConfirmOrder",components:{AddressForm:((a=s("j5I1"))&&a.__esModule?a:{default:a}).default},data:function(){var e=pageConfig;return{remark:null,address:{},newaddress:{},showDialog:!1,items:[],product_fee:0,shipping_fee:0,discount_fee:0,order_fee:0,pay_type:e.pay_type,shipping_type:e.shipping_type}},mounted:function(){var e=this;this.$get("/address/get").then((function(t){e.address=t.result.address})),this.$get("/address/batchget").then((function(t){e.addresses=t.result.items})),this.fetchData()},computed:{totalFee:function(){return this.items.reduce((function(e,t){return e+t.quantity*t.price}),0).toFixed(2)}},methods:{fetchData:function(){var e=this,t=pageConfig.items;this.$post("/order/confirm",{items:t}).then((function(t){var s=t.result.result,a=s.items,r=s.product_fee,i=s.shipping_fee,n=s.discount_fee,d=s.order_fee;e.items=a,e.product_fee=r,e.shipping_fee=i,e.discount_fee=n,e.order_fee=d}))},submit:function(){if(!this.address)return this.$showToast("请选择收货地址"),!1;var e=pageConfig.items,t=this.address,s=this.pay_type,a=this.shipping_type,r=this.remark;this.$post("/order/settlement",{items:e,address:t,pay_type:s,shipping_type:a,remark:r}).then((function(e){var t=e.result.order;window.location.href="/order/pay?order_id="+t.order_id}))},handleAddAddress:function(){this.newaddress={},this.showDialog=!0},handleEditAddress:function(e){this.newaddress=e,this.showDialog=!0},handleSavedAddress:function(e){var t=this;this.showDialog=!1,e.address_id?this.addresses.map((function(s,a){s.address_id===e.address_id&&t.addresses.splice(a,1,e)})):this.addresses.push(e)}}};t.default=r},cAgF:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"编辑地址",visible:e.visiable,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.visiable=t}}},[s("table",{staticClass:"dsxui-formtable"},[s("colgroup",[s("col",{staticClass:"w90"}),e._v(" "),s("col")]),e._v(" "),s("tbody",[s("tr",[s("td",{staticClass:"cell-label"},[e._v("收货人")]),e._v(" "),s("td",[s("el-input",{staticClass:"w300",attrs:{size:"medium"},model:{value:e.address.name,callback:function(t){e.$set(e.address,"name",t)},expression:"address.name"}})],1)]),e._v(" "),s("tr",[s("td",{staticClass:"cell-label"},[e._v("联系电话")]),e._v(" "),s("td",[s("el-input",{staticClass:"w300",attrs:{size:"medium"},model:{value:e.address.tel,callback:function(t){e.$set(e.address,"tel",t)},expression:"address.tel"}})],1)]),e._v(" "),s("tr",[s("td",{staticClass:"cell-label"},[e._v("所在地")]),e._v(" "),s("td",[s("el-cascader",{ref:"cascader",staticClass:"w300",attrs:{props:e.props,size:"medium"},on:{"update:props":function(t){e.props=t}},model:{value:e.cascaderValue,callback:function(t){e.cascaderValue=t},expression:"cascaderValue"}})],1)]),e._v(" "),s("tr",[s("td",{staticClass:"cell-label"},[e._v("详细地址")]),e._v(" "),s("td",[s("el-input",{staticClass:"w400",attrs:{size:"medium"},model:{value:e.address.street,callback:function(t){e.$set(e.address,"street",t)},expression:"address.street"}})],1)]),e._v(" "),s("tr",[s("td",{staticClass:"cell-label"},[e._v("邮政编码")]),e._v(" "),s("td",[s("el-input",{staticClass:"w300",attrs:{size:"medium"},model:{value:e.address.postalcode,callback:function(t){e.$set(e.address,"postalcode",t)},expression:"address.postalcode"}})],1)]),e._v(" "),s("tr",[s("td",{staticClass:"cell-label"}),e._v(" "),s("td",[s("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.address.isdefault,callback:function(t){e.$set(e.address,"isdefault",t)},expression:"address.isdefault"}},[e._v("设为默认地址")])],1)]),e._v(" "),s("tr",[s("td"),e._v(" "),s("td",[s("el-button",{staticClass:"w200",attrs:{size:"medium",type:"primary"},on:{click:e.handleSave}},[e._v("保存")])],1)])])])])},r=[]},j5I1:function(e,t,s){"use strict";s.r(t);var a=s("cAgF"),r=s("6aaD");for(var i in r)"default"!==i&&function(e){s.d(t,e,(function(){return r[e]}))}(i);var n=s("KHd+"),d=Object(n.a)(r.default,a.a,a.b,!1,null,"4433fa57",null);t.default=d.exports},mmJj:function(e,t,s){"use strict";function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={name:"AddressForm",model:{prop:"show",event:"change"},props:{address:{address_id:0},show:!1},data:function(){var e=this;return{props:{lazy:!0,value:"name",label:"name",lazyLoad:function(t,s){var i=t.level,n=t.data?t.data.id:0;e.$get("/district/batchget?fid="+n).then((function(e){var t=e.result.items.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},e,{leaf:i>=2})}));s(t)}))}},cascaderValue:[],visiable:!1}},mounted:function(){this.$nextTick((function(){}))},methods:{handleSave:function(){var e=this;return this.address.name?this.address.tel?0===this.cascaderValue.length?(this.$showToast("请选择所在地区"),!1):(this.address.province=this.cascaderValue[0],this.address.city=this.cascaderValue[1],this.address.district=this.cascaderValue[2],this.address.street?(this.showDialog=!1,void this.$post("/address/save",{id:this.address.id||0,address:this.address}).then((function(t){e.$showToast("地址保存成功"),e.visiable=!1,e.$emit("saved",t.result.address)}))):(this.$showToast("请填写详细地址"),!1)):(this.$showToast("请填写联系电话"),!1):(this.$showToast("请填写姓名"),!1)}},watch:{visiable:function(e){this.$emit("change",e)},show:function(e){if(this.visiable=e,e){var t=this.address,s=t.province,a=t.city,r=t.district;this.cascaderValue=[s,a,r]}}}};t.default=i}});