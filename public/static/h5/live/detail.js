!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=11)}({11:function(t,e,i){t.exports=i("I48x")},"3vu4":function(t,e,i){"use strict";i.r(e);var s=i("vNWs"),a=i("64gX");for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);var o=i("KHd+"),c=Object(o.a)(a.default,s.a,s.b,!1,null,"bae7635c",null);e.default=c.exports},"64gX":function(t,e,i){"use strict";i.r(e);var s=i("cHfL"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e.default=a.a},"6oWU":function(t,e,i){"use strict";i.r(e);var s=i("VbfH"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e.default=a.a},I48x:function(t,e,i){"use strict";var s,a=(s=i("Z9bX"))&&s.__esModule?s:{default:s};new Vue({el:"#app",render:function(t){return t(a.default)}})},"KHd+":function(t,e,i){"use strict";function s(t,e,i,s,a,n,o,c){var r,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=i,l._compiled=!0),s&&(l.functional=!0),n&&(l._scopeId="data-v-"+n),o?(r=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=r):a&&(r=c?function(){a.call(this,this.$root.$options.shadowRoot)}:a),r)if(l.functional){l._injectStyles=r;var u=l.render;l.render=function(t,e){return r.call(e),u(t,e)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,r):[r]}return{exports:t,options:l}}i.d(e,"a",(function(){return s}))},VbfH:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={name:"LiveDetail",components:{LivePlayer:((s=i("3vu4"))&&s.__esModule?s:{default:s}).default},data:function(){return{loading:!0,showDialog:!1,showQrcode:!1,message:null,tab:"hudong",player:null,websocket:null,messages:[],ticket:!1,qrcode:window.qrcode,showPoster:!1}},mounted:function(){this.fetchTicket(),this.fetchData()},methods:{fetchTicket:function(){var t=this,e=pageConfig.id;this.$get("/live/getticket",{id:e}).then((function(e){e.result.ticket&&(t.ticket=e.result.ticket)}))},fetchData:function(){var t=this,e=pageConfig.id;this.$get("/live/get",{id:e}).then((function(e){t.live=e.result.live,t.loading=!1,t.initWebsocket(),t.setShareData()}))},showFormDialog:function(){this.showDialog=!0},hideFormDialog:function(){this.showDialog=!1},onClickTab:function(t){this.tab=t},initWebsocket:function(){var t=this,e=this.live.id,i=window.pageConfig,s=i.uid,a=i.username,n="wss://shop.gzdsx.cn/ws/vfrom=wx&tid=".concat(e,"&uid=").concat(s,"&username=").concat(a),o=new WebSocket(n);o.onopen=function(e){console.log("Connected to WebSocket server."),t.sendMessage(a+"进入了直播间",2)},o.onclose=function(t){console.log("Disconnected")},o.onmessage=function(e){t.messages.length>99&&t.messages.shift(),t.messages.push(JSON.parse(e.data)),setTimeout((function(){var t=document.getElementById("chat");t.scrollTop+=t.clientHeight}),100)},o.onerror=function(t,e){console.log("Error occured: "+t.data)},this.websocket=o,setTimeout((function(){o.send("ping")}),3e4)},sendMessage:function(t,e){var i=this.live.id,s=window.pageConfig,a={tid:i,uid:s.uid,username:s.username,avatar:s.avatar,message:t,type:e};this.websocket.send(JSON.stringify(a))},handleSend:function(){if(!this.message)return this.$toast.fail({message:"评论内容不能为空",className:"w150"}),!1;this.sendMessage(this.message,1),this.message=null},buyTicket:function(){var t=this,e=this.live.id,i=window.openid;this.$post("/live/buyticket",{id:e,openid:i,appid:1}).then((function(e){var i=e.result.config;i.timestamp||(i.timestamp=i.timeStamp),i.success=function(e){t.$toast.success("付款成功"),t.fetchTicket()},wx.chooseWXPay(i)}))},setShareData:function(){var t=this.live,e=window.pageConfig.username;wx.ready((function(){wx.updateAppMessageShareData({title:t.title,desc:e+"邀请您来一起看直播",link:t.m_url,imgUrl:t.image,success:function(){console.log("设置成功")}}),wx.updateTimelineShareData({title:t.title,link:t.m_url,imgUrl:t.image,success:function(){}})}))}},computed:{}};e.default=a},Z9bX:function(t,e,i){"use strict";i.r(e);var s=i("t7di"),a=i("6oWU");for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);var o=i("KHd+"),c=Object(o.a)(a.default,s.a,s.b,!1,null,"a45ff47e",null);e.default=c.exports},cHfL:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={name:"LivePlayer",props:{live:{}},mounted:function(){this.initPlayer()},methods:{initPlayer:function(){var t=this.live,e=t.hls,i=t.hls_low,s=t.hls_hd,a=t.image,n=(t.video_url,t.hls_play_url),o={container:document.getElementById("dplayer"),video:{},live:!0,lang:"zh-cn",autoplay:!0,volume:1};1===this.live.state&&(o.live=!0,o.video={pic:a,quality:[{name:"高清",url:s,type:"hls"},{name:"标清",url:e,type:"hls"},{name:"流畅",url:i,type:"hls"}],defaultQuality:1}),2===this.live.state&&(o.live=!1,o.playbackSpeed=[.5,.75,1,1.25,1.5,2],o.video={pic:a,url:n,type:"hls"}),this.player=new DPlayer(o)}},watch:{live:function(t,e){(void 0).initPlayer()}}};e.default=s},t7di:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a}));var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.loading?i("van-loading"):i("div",{staticClass:"live-container"},[i("div",{staticClass:"live-detail"},[i("div",{staticClass:"live-player"},[0===t.live.state?i("div",{staticClass:"live-player-content"},[i("div",{staticClass:"title"},[t._v("直播尚未开始")])]):[t.ticket?i("live-player",{attrs:{live:t.live}}):i("div",{staticClass:"live-player-content"},[i("div",{staticClass:"btn-area"},[i("span",{staticClass:"btn",on:{click:t.buyTicket}},[t._v("购买本场门票")])])])]],2),t._v(" "),i("div",{staticClass:"live-tabs"},[i("div",{staticClass:"tab-item",class:{active:"hudong"===t.tab},on:{click:function(e){return t.onClickTab("hudong")}}},[t._v("互动")]),t._v(" "),i("div",{staticClass:"tab-item",class:{active:"jieshao"===t.tab},on:{click:function(e){return t.onClickTab("jieshao")}}},[t._v("介绍")]),t._v(" "),i("div",{staticClass:"tab-item",class:{active:"hezuo"===t.tab},on:{click:function(e){return t.onClickTab("hezuo")}}},[t._v("合作")]),t._v(" "),i("div",{staticClass:"subscribe",on:{click:function(e){t.showQrcode=!0}}},[t._v("+关注")])]),t._v(" "),i("div",{staticClass:"live-body"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"hudong"===t.tab,expression:"tab==='hudong'"}],staticClass:"live-content"},[i("div",{staticClass:"content",attrs:{id:"chat"}},[i("div",{staticClass:"chat-room",attrs:{id:"chat-room"}},t._l(t.messages,(function(e,s){return i("div",{key:s,staticClass:"chat-message"},[i("div",{staticClass:"time"},[t._v(t._s(e.created_at))]),t._v(" "),2===e.type?i("div",{staticClass:"wellcome-msg"},[t._v(t._s(e.message))]):i("div",{staticClass:"chat-flex"},[i("img",{staticClass:"avatar",attrs:{src:e.avatar,alt:""}}),t._v(" "),i("div",{staticClass:"flex"},[i("div",{staticClass:"username"},[t._v(t._s(e.username))]),t._v(" "),i("div",[i("span",{staticClass:"message"},[t._v(t._s(e.message))])])])])])})),0),t._v(" "),i("div",{staticClass:"h60"})])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"jieshao"===t.tab,expression:"tab==='jieshao'"}],staticClass:"live-content"},[i("div",{staticClass:"content",domProps:{innerHTML:t._s(t.live.content)}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hezuo"===t.tab,expression:"tab==='hezuo'"}],staticClass:"live-content"},[i("div",{staticClass:"content"},[t._v("商务合作内容")])])])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hudong"===t.tab,expression:"tab==='hudong'"}],staticClass:"tabbar"},[i("div",{staticClass:"bar"},[i("div",{staticClass:"bar-inner"},[i("div",{staticClass:"comment",on:{click:function(e){t.showDialog=!0}}},[t._v("说点什么吧...")])])])]),t._v(" "),i("van-dialog",{attrs:{title:"发表评论","show-cancel-button":!0,"get-container":"body"},on:{confirm:t.handleSend},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[i("van-field",{attrs:{type:"textarea",placeholder:"请输入评论内容"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),t._v(" "),i("van-dialog",{staticStyle:{width:"260px"},attrs:{"show-confirm-button":!1,"close-on-click-overlay":!0},model:{value:t.showQrcode,callback:function(e){t.showQrcode=e},expression:"showQrcode"}},[i("div",{staticClass:"dialog-qrcode"},[i("img",{attrs:{src:t.qrcode,alt:""}}),t._v(" "),i("p",[t._v("长按识别上方二维码关注公众号")])])]),t._v(" "),i("van-popup",{staticClass:"live-poster-popup",attrs:{closeable:""},model:{value:t.showPoster,callback:function(e){t.showPoster=e},expression:"showPoster"}},[i("img",{staticClass:"live-poster",attrs:{src:"/h5/live/poster/"+t.live.id}})]),t._v(" "),i("div",{staticClass:"live-invite",on:{click:function(e){t.showPoster=!0}}},[i("img",{attrs:{src:"/images/app/yaoqing.png"}})])],1)},a=[]},vNWs:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a}));var s=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"dplayer",attrs:{id:"dplayer"}})},a=[]}});